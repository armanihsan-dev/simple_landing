# Name of your workflow - appears in GitHub Actions tab
name: Deploy to S3

# WHEN to run the workflow
on:
  push:
    branches: [main] # Runs when you push to main branch
  workflow_dispatch: # Allows manual trigger from GitHub UI

# WHAT to do when triggered
jobs:
  deploy:
    runs-on: ubuntu-latest # The robot uses Ubuntu computer

    steps:
      # Step 1: Get your code from GitHub
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v3

      # Step 2: Install Node.js so we can build React
      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      # Step 3: Install dependencies (react-scripts, etc)
      - name: ğŸ“¦ Install dependencies
        run: npm ci # 'ci' is faster than 'install' for robots

      # Step 4: Build the React app
      - name: ğŸ—ï¸ Build React app
        run: npm run build
        env:
          CI: false # Prevents warnings from stopping the build

      # Step 5: Give robot the AWS keys
      - name: ğŸ”‘ Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-1 # Change to your bucket's region

      # Step 6: Send files to S3
      - name: ğŸš€ Deploy to S3
        run: |
          # Sync dist folder to S3 bucket
          aws s3 sync ./dist/ s3://${{ secrets.AWS_S3_BUCKET }}/ \
            --delete  # Remove files not in dist folder

      # Step 7: Get the URL
      - name: ğŸŒ Get website URL
        run: |
          echo "âœ… Site deployed to:"
          echo "http://${{secrets.AWS_S3_BUCKET}}.s3-website-us-east-1.amazonaws.com"
